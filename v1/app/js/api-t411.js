"use strict";!function(){function t(t){this.apiDB=t,this.t411Client={},this.name=null}var e=require("fs"),n=require("t411"),i=(require("shell"),require("superagent")),r=require("path-extra");t.prototype.connectToApi=function(t){var e=this;e.t411Client=new n,utils.getParam(e.apiDB,"T4access",function(n){e.t411Client.auth(n.login,n.password,function(n){e.t411Client.profile(e.t411Client.uid,function(n,i){n||(e.name=i.username),t()})})},!0)},t.prototype.disconnectToApi=function(t){var e=this;e.name=null,e.t411Client={},t()},t.prototype.searchTheBest=function(t,e){var n=this;return new Promise(function(e,i){n.t411Client.token?n.t411Client.search(t+"?limit=50",function(t,n){t&&i(),e(n)}):i()})},t.prototype.saveAccess=function(t,e,n){var i=this;utils.setParam(i.apiDB,"T4access",{login:t,password:e},n,!0)},t.prototype.searchAll=function(t){var e=this;return new Promise(function(n,i){e.t411Client.token?e.t411Client.search(t+"?limit=50",function(t,e){if(t)i();else{var r=[],o=!0,a=!1,s=void 0;try{for(var l,u=e.torrents[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=l.value;r.push({title:c.name,torrentLink:c.id,seeds:c.seeders,tracker:"t411"})}}catch(t){a=!0,s=t}finally{try{!o&&u["return"]&&u["return"]()}finally{if(a)throw s}}n(r)}}):i()})},t.prototype.downloadTorrent=function(t){var n=this;return new Promise(function(o,a){if(n.t411Client.token){var s=n.t411Client.url("/torrents/download/"+t),l=r.tempdir()+"/"+Math.floor(9e5*Math.random()+1e5)+".torrent",u=e.createWriteStream(l);i.get(s).set("Authorization",n.t411Client.token).pipe(u).on("finish",function(){o(l)})}else a()})},exports.apiT411=t}();