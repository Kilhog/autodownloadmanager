"use strict";!function(){function n(n,t,e,i){this.apiTR=n,this.allTO={apiT4:t,apiKA:e,apiRB:i}}var t=require("shell"),e=require("underscore");n.prototype.searchAndDownload=function(n,t){var e=this;return new Promise(function(i,o){e.callApiTracker(n,t).then(function(n){e.download(n),i()},o)})},n.prototype.callApiTracker=function(n,t){var e=this;return new Promise(function(i,o){var r=1,a=0,s=null,u=function(n){a+=1,n&&(s&&s.seeds<n.seeds||!s)&&n.torrentLink&&(s=n),r===a&&s?i(s.torrentLink):r===a&&o()};e.allTO.apiKA.searchTheBest(n,t).then(u,u)})},n.prototype.download=function(n,e){var i=this;return new Promise(function(o,r){"t411"==e?i.allTO.apiT4.downloadTorrent(n).then(function(n){i.apiTR.transmission_obj?i.apiTR.addFile(n).then(o):(t.openItem(n),r())},r):i.apiTR.transmission_obj?i.apiTR.addUrl(n,function(){o()}):(t.openExternal(n),r())})},n.prototype.getTorrentsWithSearch=function(n,t){var i=this,o=[],r=function(n){o=e.chain(o).union(n).uniq().sortBy(function(n){return-1*n.seeds}).value(),t(o)};e.each(i.allTO,function(t){t.searchAll(n).then(r,function(){})})},module.exports=n}();